<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>契約者登録フォーム</title>
    
    <!-- デザイン用CSS (Tailwind) -->
    <!-- 本番環境では警告が出ますが、この構成のまま消すことはできません。機能には問題ありません。 -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React本体 (Production版) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (JSX変換用 - no-warning設定追加) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        .animation-fade-in { animation: fadeIn 0.5s ease-in; }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <!-- type="text/babel" に data-presets="react" を追加 -->
    <script type="text/babel" data-presets="react">
        const { useState } = React;
        const { createRoot } = ReactDOM;

        // --- アイコン ---
        const IconBase = ({ children, className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>);
        const Sun = ({className}) => <IconBase className={className}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></IconBase>;
        const CheckCircle = ({className}) => <IconBase className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const AlertCircle = ({className}) => <IconBase className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>;
        const User = ({className}) => <IconBase className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>;
        const MapPin = ({className}) => <IconBase className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const Phone = ({className}) => <IconBase className={className}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></IconBase>;
        const Mail = ({className}) => <IconBase className={className}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></IconBase>;
        const CreditCard = ({className}) => <IconBase className={className}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></IconBase>;
        const BatteryCharging = ({className}) => <IconBase className={className}><path d="M5 18H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h3.19M15 6h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-3.19"/><line x1="23" x2="23" y1="13" y2="11"/><polyline points="11 6 7 12 13 12 9 18"/></IconBase>;
        const Home = ({className}) => <IconBase className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconBase>;
        const Zap = ({className}) => <IconBase className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>;
        const Briefcase = ({className}) => <IconBase className={className}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconBase>;
        const Wrench = ({className}) => <IconBase className={className}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></IconBase>;
        const Clock = ({className}) => <IconBase className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const Send = ({className}) => <IconBase className={className}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></IconBase>;

        function ContractForm() {
            // ▼▼▼ ここにGASのウェブアプリURLを貼り付けてください ▼▼▼
            const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzIbrY99Xx0p09xsl91MXi1OshxgcKAY1kza8dUr3uJzzJuk7udlJQXC-xbNJ6VHVh30g/exec"; 
            // ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

            const [formData, setFormData] = useState({
                contractType: '自社',
                contractDate: new Date().toISOString().slice(0, 10),
                contractorName: '',
                furigana: '', // 追加
                postalCode: '',
                address: '',
                phone: '',
                email: '',
                contractAmount: '',
                selectedProducts: [],
                solarManufacturer: '',
                solarCapacity: '',
                batteryManufacturer: '',
                batteryCapacity: '',
                ecoCuteManufacturer: '',
                ecoCuteCapacity: '',
                v2hManufacturer: '',
                ihManufacturer: '',
                apStaffName: '',
                clStaffName: '',
                surveyDate: '',
                constructionDate: '',
                isConstructionUndecided: false,
                constructionShop: '',
                notes: ''
            });

            const [status, setStatus] = useState('idle');
            const [errorMessage, setErrorMessage] = useState('');

            const PRODUCT_OPTIONS = [
                { id: 'solar', label: 'ソーラーパネル' },
                { id: 'battery', label: '蓄電池' },
                { id: 'ecocute', label: 'エコキュート' },
                { id: 'v2h', label: 'V2H' },
                { id: 'ih', label: 'IH' },
            ];

            const handleChange = (e) => {
                const { name, value, type, checked } = e.target;
                if (type === 'checkbox') {
                    if (name === 'isConstructionUndecided') {
                        setFormData(prev => ({ ...prev, [name]: checked }));
                    } else if (name === 'products') {
                        const currentProducts = [...formData.selectedProducts];
                        if (checked) {
                            currentProducts.push(value);
                        } else {
                            const index = currentProducts.indexOf(value);
                            if (index > -1) currentProducts.splice(index, 1);
                        }
                        setFormData(prev => ({ ...prev, selectedProducts: currentProducts }));
                    }
                } else {
                    setFormData(prev => ({ ...prev, [name]: value }));
                }
            };

            const handlePostalCodeBlur = () => {};

            const handleSubmit = async (e) => {
                e.preventDefault();
                setStatus('loading');
                setErrorMessage('');

                // GASのURLが設定されていない場合の警告
                if (GAS_WEB_APP_URL.includes("ここにGAS")) {
                    alert("コード内の 'GAS_WEB_APP_URL' にGASのデプロイURLを設定してください。");
                    setStatus('idle');
                    return;
                }

                try {
                    const response = await fetch(GAS_WEB_APP_URL, {
                        method: "POST",
                        body: JSON.stringify(formData),
                        headers: {
                            "Content-Type": "text/plain;charset=utf-8"
                        }
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    setStatus('success');
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                } catch (error) {
                    console.error('Error:', error);
                    setStatus('error');
                    setErrorMessage('送信に失敗しました。');
                }
            };

            const handleReset = () => {
                setFormData({
                    contractType: '自社',
                    contractDate: new Date().toISOString().slice(0, 10),
                    contractorName: '',
                    furigana: '',
                    postalCode: '',
                    address: '',
                    phone: '',
                    email: '',
                    contractAmount: '',
                    selectedProducts: [],
                    solarManufacturer: '',
                    solarCapacity: '',
                    batteryManufacturer: '',
                    batteryCapacity: '',
                    ecoCuteManufacturer: '',
                    ecoCuteCapacity: '',
                    v2hManufacturer: '',
                    ihManufacturer: '',
                    apStaffName: '',
                    clStaffName: '',
                    surveyDate: '',
                    constructionDate: '',
                    isConstructionUndecided: false,
                    constructionShop: '',
                    notes: ''
                });
                setStatus('idle');
            };

            return (
                <div className="min-h-screen py-10 px-4 sm:px-6 lg:px-8 font-sans text-slate-900">
                    <div className="max-w-3xl mx-auto">
                        <div className="text-center mb-8">
                            <div className="flex justify-center mb-4"><div className="bg-gradient-to-br from-yellow-400 to-orange-500 p-4 rounded-full shadow-lg"><Sun className="h-8 w-8 text-white" /></div></div>
                            <h2 className="text-3xl font-extrabold text-slate-900 tracking-tight">契約者登録フォーム</h2>
                            <p className="mt-2 text-sm text-slate-500">ご成約おめでとうございます！詳細情報を入力してください。</p>
                        </div>
                        <div className="bg-white shadow-xl rounded-2xl overflow-hidden border border-slate-200">
                            {status === 'success' ? (
                                <div className="p-10 text-center animation-fade-in">
                                    <div className="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-green-100 mb-6"><CheckCircle className="h-10 w-10 text-green-600" /></div>
                                    <h3 className="text-2xl font-bold text-slate-900 mb-2">登録完了！</h3>
                                    <p className="text-slate-600 mb-8 max-w-md mx-auto">Kintoneへの登録とLINEグループへの通知が完了しました。<br/>事務局にて確認作業に入ります。</p>
                                    <button onClick={handleReset} className="w-full sm:w-auto inline-flex justify-center py-3 px-8 border border-transparent shadow-sm text-sm font-bold rounded-full text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">続けて新しい契約を入力</button>
                                </div>
                            ) : (
                                <form className="divide-y divide-slate-100" onSubmit={handleSubmit}>
                                    <div className="p-6 sm:p-8 space-y-6">
                                        <h3 className="text-lg font-bold text-slate-900 flex items-center"><User className="w-5 h-5 mr-2 text-blue-500" />お客様情報</h3>
                                        <div className="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                            <div className="sm:col-span-1">
                                                <label className="block text-sm font-medium text-slate-700">契約種別 <span className="text-red-500">*</span></label>
                                                <select name="contractType" value={formData.contractType} onChange={handleChange} className="mt-1 block w-full py-3 px-3 border border-slate-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                                    <option value="自社">自社</option>
                                                    <option value="FIT">FIT</option>
                                                </select>
                                            </div>
                                            <div className="sm:col-span-1">
                                                <label className="block text-sm font-medium text-slate-700">契約日 <span className="text-red-500">*</span></label>
                                                <input type="date" name="contractDate" required className="mt-1 block w-full py-3 px-3 border border-slate-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value={formData.contractDate} onChange={handleChange} />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700">契約者名（お客様名） <span className="text-red-500">*</span></label>
                                            <input type="text" name="contractorName" required className="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md py-3 px-3 border" placeholder="例：山田 太郎" value={formData.contractorName} onChange={handleChange} />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700">フリガナ <span className="text-red-500">*</span></label>
                                            <input type="text" name="furigana" required className="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md py-3 px-3 border" placeholder="例：ヤマダ タロウ" value={formData.furigana} onChange={handleChange} />
                                        </div>
                                        <div className="grid grid-cols-1 gap-6 sm:grid-cols-3">
                                            <div className="sm:col-span-1">
                                                <label className="block text-sm font-medium text-slate-700">郵便番号</label>
                                                <input type="text" name="postalCode" className="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-slate-300 rounded-md py-3 px-3 border" placeholder="123-4567" value={formData.postalCode} onChange={handleChange} onBlur={handlePostalCodeBlur} />
                                            </div>
                                            <div className="sm:col-span-2">
                                                <label className="block text-sm font-medium text-slate-700">設置場所住所 <span className="text-red-500">*</span></label>
                                                <div className="mt-1 relative rounded-md shadow-sm">
                                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><MapPin className="h-5 w-5 text-slate-400" /></div>
                                                    <input type="text" name="address" required className="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-slate-300 rounded-md py-3 border" placeholder="例：東京都千代田区..." value={formData.address} onChange={handleChange} />
                                                </div>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                            <div>
                                                <label className="block text-sm font-medium text-slate-700">電話番号 <span className="text-red-500">*</span></label>
                                                <div className="mt-1 relative rounded-md shadow-sm">
                                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><Phone className="h-5 w-5 text-slate-400" /></div>
                                                    <input type="tel" name="phone" required className="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-slate-300 rounded-md py-3 border" placeholder="090-1234-5678" value={formData.phone} onChange={handleChange} />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-slate-700">メールアドレス</label>
                                                <div className="mt-1 relative rounded-md shadow-sm">
                                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><Mail className="h-5 w-5 text-slate-400" /></div>
                                                    <input type="email" name="email" className="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 sm:text-sm border-slate-300 rounded-md py-3 border" placeholder="example@email.com" value={formData.email} onChange={handleChange} />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="p-6 sm:p-8 space-y-6 bg-slate-50">
                                        <h3 className="text-lg font-bold text-slate-900 flex items-center"><Zap className="w-5 h-5 mr-2 text-yellow-500" />契約・商材情報</h3>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700">契約金額 (税込) <span className="text-red-500">*</span></label>
                                            <div className="mt-1 relative rounded-md shadow-sm max-w-xs">
                                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><CreditCard className="h-5 w-5 text-slate-400" /></div>
                                                <input type="number" name="contractAmount" required className="focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 pr-12 sm:text-sm border-slate-300 rounded-md py-3 border" placeholder="2000000" value={formData.contractAmount} onChange={handleChange} />
                                                <div className="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"><span className="text-slate-500 sm:text-sm">円</span></div>
                                            </div>
                                        </div>
                                        <div>
                                            <span className="block text-sm font-medium text-slate-700 mb-2">商材情報（複数選択可） <span className="text-red-500">*</span></span>
                                            <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                                {PRODUCT_OPTIONS.map((option) => (
                                                    <label key={option.id} className={`relative flex items-center p-3 rounded-lg border cursor-pointer transition-all ${formData.selectedProducts.includes(option.id) ? 'bg-blue-50 border-blue-500 ring-1 ring-blue-500' : 'bg-white border-slate-300 hover:bg-slate-50'}`}>
                                                        <input type="checkbox" name="products" value={option.id} checked={formData.selectedProducts.includes(option.id)} onChange={handleChange} className="h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-300 rounded" />
                                                        <span className="ml-3 text-sm font-medium text-slate-900">{option.label}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>
                                        {/* 商材詳細エリア (省略なしで記載) */}
                                        <div className="space-y-4 border-t border-slate-200 pt-4 mt-4">
                                            {formData.selectedProducts.includes('solar') && (
                                                <div className="bg-white p-4 rounded-md border border-yellow-200 shadow-sm animate-fade-in-up">
                                                    <h4 className="font-bold text-yellow-700 mb-3 flex items-center"><Sun className="w-4 h-4 mr-1"/> ソーラーパネル詳細</h4>
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                        <div><label className="block text-xs font-medium text-slate-500">メーカー名</label><input type="text" name="solarManufacturer" value={formData.solarManufacturer} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm border p-2" placeholder="例：Qセルズ" /></div>
                                                        <div><label className="block text-xs font-medium text-slate-500">システム容量 (kW)</label><input type="number" step="0.01" name="solarCapacity" value={formData.solarCapacity} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm border p-2" placeholder="例：5.5" /></div>
                                                    </div>
                                                </div>
                                            )}
                                            {/* 他の商材詳細も同様に表示 (省略) */}
                                            {formData.selectedProducts.includes('battery') && (<div className="bg-white p-4 rounded-md border border-green-200 shadow-sm animate-fade-in-up"><h4 className="font-bold text-green-700 mb-3 flex items-center"><BatteryCharging className="w-4 h-4 mr-1"/> 蓄電池詳細</h4><div className="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label className="block text-xs font-medium text-slate-500">メーカー名</label><input type="text" name="batteryManufacturer" value={formData.batteryManufacturer} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm border p-2" placeholder="例：ニチコン" /></div><div><label className="block text-xs font-medium text-slate-500">蓄電容量 (kWh)</label><input type="number" step="0.01" name="batteryCapacity" value={formData.batteryCapacity} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm border p-2" placeholder="例：9.8" /></div></div></div>)}
                                            {formData.selectedProducts.includes('ecocute') && (<div className="bg-white p-4 rounded-md border border-blue-200 shadow-sm animate-fade-in-up"><h4 className="font-bold text-blue-700 mb-3 flex items-center"><Home className="w-4 h-4 mr-1"/> エコキュート詳細</h4><div className="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label className="block text-xs font-medium text-slate-500">メーカー名</label><input type="text" name="ecoCuteManufacturer" value={formData.ecoCuteManufacturer} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm border p-2" placeholder="例：ダイキン" /></div><div><label className="block text-xs font-medium text-slate-500">タンク容量 (L)</label><input type="number" name="ecoCuteCapacity" value={formData.ecoCuteCapacity} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm border p-2" placeholder="例：370" /></div></div></div>)}
                                            {formData.selectedProducts.includes('v2h') && (<div className="bg-white p-4 rounded-md border border-indigo-200 shadow-sm animate-fade-in-up"><h4 className="font-bold text-indigo-700 mb-3 flex items-center"><Zap className="w-4 h-4 mr-1"/> V2H詳細</h4><div><label className="block text-xs font-medium text-slate-500">メーカー名</label><input type="text" name="v2hManufacturer" value={formData.v2hManufacturer} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border p-2" placeholder="例：ニチコン" /></div></div>)}
                                            {formData.selectedProducts.includes('ih') && (<div className="bg-white p-4 rounded-md border border-red-200 shadow-sm animate-fade-in-up"><h4 className="font-bold text-red-700 mb-3 flex items-center"><Zap className="w-4 h-4 mr-1"/> IH詳細</h4><div><label className="block text-xs font-medium text-slate-500">メーカー名</label><input type="text" name="ihManufacturer" value={formData.ihManufacturer} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 sm:text-sm border p-2" placeholder="例：パナソニック" /></div></div>)}
                                        </div>
                                    </div>
                                    <div className="p-6 sm:p-8 space-y-6">
                                        <h3 className="text-lg font-bold text-slate-900 flex items-center"><Briefcase className="w-5 h-5 mr-2 text-indigo-500" />担当・施工情報</h3>
                                        <div className="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                            <div><label className="block text-sm font-medium text-slate-700">AP担当者名 <span className="text-red-500">*</span></label><input type="text" name="apStaffName" required value={formData.apStaffName} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border py-3 px-3" placeholder="アポインター名" /></div>
                                            <div><label className="block text-sm font-medium text-slate-700">CL担当者名 <span className="text-red-500">*</span></label><input type="text" name="clStaffName" required value={formData.clStaffName} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border py-3 px-3" placeholder="クローザー名" /></div>
                                        </div>
                                        <div className="border-t border-slate-200 my-4"></div>
                                        <div className="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                            <div><label className="block text-sm font-medium text-slate-700 flex items-center"><Wrench className="w-4 h-4 mr-1 text-slate-400" /> 現調日 (日時)</label><input type="datetime-local" name="surveyDate" className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border py-2 px-3" value={formData.surveyDate} onChange={handleChange} /></div>
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-slate-700 flex items-center"><Clock className="w-4 h-4 mr-1 text-slate-400" /> 施工日</label>
                                                    <div className="flex items-center"><input id="isConstructionUndecided" name="isConstructionUndecided" type="checkbox" className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-slate-300 rounded" checked={formData.isConstructionUndecided} onChange={handleChange} /><label htmlFor="isConstructionUndecided" className="ml-2 block text-xs text-slate-500 cursor-pointer">未定の場合はチェック</label></div>
                                                </div>
                                                <input type="date" name="constructionDate" disabled={formData.isConstructionUndecided} className={`mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border py-2 px-3 ${formData.isConstructionUndecided ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : ''}`} value={formData.constructionDate} onChange={handleChange} />
                                            </div>
                                        </div>
                                        <div className="mt-4">
                                            <label className="block text-sm font-medium text-slate-700">担当施工店</label>
                                            <select name="constructionShop" value={formData.constructionShop} onChange={handleChange} className="mt-1 block w-full py-2 px-3 border border-slate-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <option value="">選択してください</option>
                                                <option value="APC">APC</option>
                                                <option value="テクノホーム">テクノホーム</option>
                                                <option value="TERRA">TERRA</option>
                                                <option value="その他">その他(※備考欄に記述)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label htmlFor="notes" className="block text-sm font-medium text-slate-700">備考・特記事項</label>
                                            <div className="mt-1">
                                                <textarea id="notes" name="notes" rows={4} className="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border border-slate-300 rounded-md p-3" placeholder="その他共有事項があればご記入ください" value={formData.notes} onChange={handleChange} />
                                            </div>
                                        </div>
                                    </div>
                                    {status === 'error' && (
                                        <div className="p-4 bg-red-50">
                                            <div className="flex">
                                                <div className="flex-shrink-0"><AlertCircle className="h-5 w-5 text-red-400" /></div>
                                                <div className="ml-3"><h3 className="text-sm font-medium text-red-800">エラーが発生しました</h3><div className="mt-2 text-sm text-red-700">{errorMessage}</div></div>
                                            </div>
                                        </div>
                                    )}
                                    <div className="px-6 py-8 bg-slate-50 sm:px-10 flex justify-end rounded-b-2xl">
                                        <button type="submit" disabled={status === 'loading'} className={`w-full sm:w-auto inline-flex justify-center items-center py-4 px-8 border border-transparent shadow-lg text-lg font-bold rounded-full text-white transition-all transform hover:-translate-y-0.5 ${status === 'loading' ? 'bg-slate-400 cursor-not-allowed shadow-none' : 'bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500'}`}>
                                            {status === 'loading' ? (<><svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>送信中...</>) : (<><Send className="mr-2 h-5 w-5" />契約を確定・報告する</>)}
                                        </button>
                                    </div>
                                </form>
                            )}
                        </div>
                        <div className="mt-8 text-center"><p className="text-xs text-slate-400 font-medium">営業管理システム © 2025 Solar Sales Co.</p></div>
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<ContractForm />);
    </script>
</body>
</html>
